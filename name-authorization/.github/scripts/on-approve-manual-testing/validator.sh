#!/bin/bash

# ============================================
# Валидация входных параметров
# ============================================

validate_inputs() {
    echo ""
    echo "╔════════════════════════════════════════════════════════════╗"
    echo "║              ВАЛИДАЦИЯ ВХОДНЫХ ПАРАМЕТРОВ                  ║"
    echo "╚════════════════════════════════════════════════════════════╝"
    echo ""

    local has_errors=false

    # Валидация формата тега
    echo "─────────────────────────────────────────"
    echo "Проверка формата тега"
    echo "─────────────────────────────────────────"

    if [[ ! "$TAG_NAME" =~ ^v[0-9]+\.[0-9]+\.[0-9]+.*$ ]]; then
        echo "❌ Неверный формат тега: $TAG_NAME"
        echo "   Ожидается формат: v1.0.0 или v1.0.0-rc.1"
        has_errors=true
    else
        echo "✅ Формат тега корректен: $TAG_NAME"
    fi
    echo ""

    # Валидация Release ID
    echo "─────────────────────────────────────────"
    echo "Проверка Release ID"
    echo "─────────────────────────────────────────"

    if [[ ! "$RELEASE_ID" =~ ^[0-9]+$ ]]; then
        echo "❌ Неверный формат Release ID: $RELEASE_ID"
        echo "   Ожидается числовое значение"
        has_errors=true
    else
        echo "✅ Release ID корректен: $RELEASE_ID"
    fi
    echo ""

    # Проверка наличия ошибок
    if [ "$has_errors" = true ]; then
        echo "╔════════════════════════════════════════════════════════════╗"
        echo "║              ВАЛИДАЦИЯ НЕ ПРОЙДЕНА                         ║"
        echo "╚════════════════════════════════════════════════════════════╝"
        echo ""
        exit 1
    fi

    echo "╔════════════════════════════════════════════════════════════╗"
    echo "║              ВАЛИДАЦИЯ УСПЕШНА                             ║"
    echo "╚════════════════════════════════════════════════════════════╝"
    echo ""
    echo "📦 Сервис:      $SERVICE_NAME"
    echo "🏷️  Версия:      $TAG_NAME"
    echo "🆔 Release ID:  $RELEASE_ID"
    echo ""
}